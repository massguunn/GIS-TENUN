<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Detail Gendang Beleq</title>
    <link rel="icon" href="/img/pavicon.png" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <style>
      /* Navbar */
      .navbar {
        background: linear-gradient(90deg, #0d6efd, #0a58ca);
      }
      .navbar .navbar-brand {
        color: #fff !important;
      }

      /* Box */
      .detail-box {
        background: #ffffff;
        border-radius: 1rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      }

      /* Section Title */
      .section-title {
        font-size: 1.8rem;
        font-weight: bold;
        color: #0d6efd;
        margin-bottom: 2rem;
        text-align: center;
        position: relative;
      }
      .section-title::after {
        content: "";
        position: absolute;
        width: 60px;
        height: 4px;
        background: #0d6efd;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 4px;
      }

      /* Carousel Produk */
      :root {
        --card-width: 280px;
        --gap: 1.5rem;
      }
      .carousel-wrapper {
        position: relative;
      }
      .carousel-produk {
        display: grid;
        gap: var(--gap);
        grid-auto-flow: column;
        scroll-snap-type: x mandatory;
        overflow-x: auto;
        scrollbar-width: none;
        padding-bottom: 1rem;
        scroll-behavior: smooth;
      }
      .carousel-produk::-webkit-scrollbar {
        display: none;
      }

      .day-card {
        width: var(--card-width);
        scroll-snap-align: center;
        border-radius: 12px;
        background: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        overflow: hidden;
      }
      .day-card:hover {
        transform: translateY(-6px);
      }
      .day-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }
      .day-card .meta {
        padding: 1rem;
        text-align: center;
      }
      .day-card .meta h2 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
      }
      .day-card .meta .desc {
        font-size: 1rem;
        font-weight: bold;
        color: #198754;
      }

      /* Tombol Navigasi */
      .carousel-btn {
        position: absolute;
        top: 40%;
        transform: translateY(-50%);
        background: rgba(13, 110, 253, 0.8);
        border: none;
        color: #fff;
        padding: 0.7rem 1rem;
        border-radius: 50%;
        cursor: pointer;
        z-index: 10;
        transition: background 0.3s ease;
      }
      .carousel-btn:hover {
        background: #0a58ca;
      }
      .carousel-btn.prev {
        left: -20px;
      }
      .carousel-btn.next {
        right: -20px;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg shadow-sm">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/">TENUN LOMBOK TIMUR</a>
        <div class="ms-auto">
          <a href="/gis" class="btn btn-light fw-semibold">‚Üê Kembali</a>
        </div>
      </div>
    </nav>

    <!-- Gambar -->
    <div class="image-wrapper text-center">
      <h2 class="fw-bold mt-5 text-primary">Gambar Toko Tenun</h2>
      <img
        src="http://localhost:3000/uploads/<%= item.gambar.replace(/^(\/)?uploads\//, '') %>"
        alt="<%= item.nama_toko %>"
        class="custom-image shadow rounded mt-3"
        style="max-width: 600px; width: 100%"
        onerror="this.src='https://placehold.co/600x400?text=No+Image'"
      />
    </div>

    <!-- Detail -->
    <div class="container mt-5">
      <div class="detail-box p-4">
        <h2 class="fw-bold mb-4 text-center text-primary">
          <%= item.nama_pemilik %>
        </h2>
        <p><strong>Alamat:</strong> <%= item.alamat %></p>
        <p><strong>Nomor HP:</strong> <%= item.nomer_hp %></p>
        <p><strong>Deskripsi:</strong> <%= item.deskripsi %></p>

        <!-- Tombol Hubungi -->
        <div class="text-center my-4">
          <a
            href="https://wa.me/<%= item.nomer_hp %>?text=Halo%2C%20saya%20tertarik%20dengan%20layanan%20Gendang%20Beleq%20anda"
            target="_blank"
            class="btn btn-success btn-lg d-inline-flex align-items-center gap-2 shadow-sm"
          >
            <i class="fa-brands fa-whatsapp fa-lg"></i> Hubungi via WhatsApp
          </a>
        </div>
      </div>
    </div>

    <!-- Produk -->
    <div class="container mt-5">
      <div class="detail-box p-4">
        <h2 class="section-title">üõçÔ∏è Daftar Produk</h2>

        <% if (produk.length > 0) { %>
        <div class="carousel-wrapper">
          <button class="carousel-btn prev">
            <i class="fas fa-chevron-left"></i>
          </button>
          <ul class="carousel-produk">
            <% produk.forEach((p) => { %>
            <li class="day-card">
              <% if (p.gambar) { %>
              <img
                src="http://localhost:3000/<%= p.gambar.replace(/^(\/)?/, '') %>"
                alt="Produk"
              />
              <% } else { %>
              <img src="/produk/default.png" alt="Produk" />
              <% } %>

              <div class="meta">
                <h2><%= p.nama %></h2>
                <p class="desc">Rp <%= p.harga.toLocaleString("id-ID") %></p>
              </div>
            </li>
            <% }) %>
          </ul>
          <button class="carousel-btn next">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <% } else { %>
        <div class="alert alert-warning text-center">
          ‚ö†Ô∏è Belum ada produk untuk pengerajin ini.
        </div>
        <% } %>
      </div>
    </div>

    <!-- Lokasi -->
    <div class="container mt-5">
      <div class="detail-box p-4">
        <h2 class="section-title">üìç Lokasi Toko</h2>
        <iframe
          src="<%= item.maps %>"
          width="100%"
          height="300"
          allowfullscreen
          loading="lazy"
          class="rounded shadow-sm"
          referrerpolicy="no-referrer-when-downgrade"
        ></iframe>
      </div>
    </div>

    <!-- Script -->
    <script>
      const carousel = document.querySelector(".carousel-produk");
      const prevBtn = document.querySelector(".carousel-btn.prev");
      const nextBtn = document.querySelector(".carousel-btn.next");

      const cardWidth =
        document.querySelector(".day-card")?.offsetWidth + 24 || 300;

      prevBtn.addEventListener("click", () => {
        carousel.scrollBy({ left: -cardWidth, behavior: "smooth" });
      });
      nextBtn.addEventListener("click", () => {
        carousel.scrollBy({ left: cardWidth, behavior: "smooth" });
      });
    </script>
  </body>
</html>
